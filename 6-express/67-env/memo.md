# **_Check Env_**

> Usually we treat the **env setting** as a non-express related part, so we do it in **server.js**, it's a convention.

## **Express Env**

![Alt check express's env](pic/bandicam%202022-10-21%2004-43-34-677.jpg)

- This env is generated by Express and is used to indicate the mode in which the app is currently running.
  - But we won't be using it, just letting you know that Express itself generates env, too.

## **NodeJS Env**

![Alt check nodejs env](pic/bandicam%202022-10-21%2004-44-36-910.jpg)

- process.env lists NodeJS env, which are the things that NodeJS itself uses internally when running.

![Alt check a common nodejs env](pic/bandicam%202022-10-21%2004-48-12-419.jpg)

- Of course, we can only check single env, above example is PWD.

## **NODE_ENV**

![Alt check a common nodejs env but we need to define it by ourself](pic/bandicam%202022-10-21%2004-48-48-847.jpg)

- We usually use the **NODE_ENV** env to determine what mode the server is currently running in, however, this env needs to be created by ourself.
  - We will fine-tune some parameters or even control whether some middleware should operate according to server running mode.

# **_Define Env with CLI_**

![Alt define env in the command](pic/bandicam%202022-10-21%2004-50-19-701.jpg)

![Alt define a random env in the command](pic/bandicam%202022-10-21%2004-51-28-893.jpg)

- We can define any env we want when we start the server.
  - But the name env is usually in **capital letters**, which is the convention.

# **_Env File and How to Load it_**

> If we need to define a lot of env, it is impractical to write it in the CLI, so it must be written in a file dedicated to configuration.

## **Configuration file**

![Alt create an env file](pic/bandicam%202022-10-21%2004-53-36-461.jpg)

## **dotenv**

> We need to use 3rd-party package **dotenv** to load env setting from env file to our app.

![Alt install dotenv](pic/bandicam%202022-10-21%2005-19-57-138.jpg)

![Alt load env file with dotenv](pic/bandicam%202022-10-21%2005-22-01-188.jpg)

## **Use Env**

![Alt use env PORT](pic/bandicam%202022-10-21%2005-24-26-553.jpg)

# **_Use NODE_ENV to control Middleware_**

> In addition to the simple example of PORT above, let's try to use env for more complex operations - controlling the **middleware** and using env in **different modules**.

## **Add condition with NODE_ENV to controll Middleware**

![Alt analyze 'morgan' middleware](pic/bandicam%202022-10-21%2005-26-14-489.jpg)

![Alt wrap morgan middleware with condition by NODE_ENV](pic/bandicam%202022-10-21%2005-28-53-414.jpg)

- Although we load the env file in **server.js**, we can also use the loaded env in any other module directly.

![Alt send request](pic/bandicam%202022-10-21%2005-32-14-973.jpg)

![Alt result morgan not work](pic/bandicam%202022-10-21%2005-33-34-552.jpg)

## **Solve Problem: Importing Order**

![Alt move loading env before including app](pic/bandicam%202022-10-21%2005-35-03-003.jpg)

- In server.js, the instruction of loading env file must **precede** the instruction of including custom module, so that other modules can use the loaded env properly.
  - This **order** is important.

![Alt send request](pic/bandicam%202022-10-21%2005-35-17-428.jpg)

![Alt morgan work](pic/bandicam%202022-10-21%2005-35-58-373.jpg)

# **_Write Scripts for Develpment/Production Start_**

> We can write different **scripts** in **package.json** to start the server in either **development** or **production** mode.

![Alt write scrips](pic/bandicam%202022-10-21%2005-39-25-791.jpg)

![Alt npm run start:prod](pic/bandicam%202022-10-21%2005-41-31-550.jpg)

![Alt send request](pic/bandicam%202022-10-21%2005-42-04-377.jpg)

![Alt result production and morgan middleware diable](pic/bandicam%202022-10-21%2005-43-08-262.jpg)
